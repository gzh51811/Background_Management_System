"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}document.addEventListener("DOMContentLoaded",function(){function t(){for(var e=0;e<$(".img_sort").length;e++)$(".img_sort").eq(e).prop("src","../img/jiantou.png")}function o(e){for(var t=[].concat(_toConsumableArray(document.querySelectorAll(".one"))),o=0;o<t.length;o++)e?$(t[o].parentElement).addClass("layui-form-checked"):$(t[o].parentElement).removeClass("layui-form-checked")}function a(){$(".shopName").val().trim()?Cookie.setCookie("mohu","mohu"):Cookie.setCookie("mohu","")}function i(){for(var e=[],t=0;t<document.querySelectorAll("tbody>tr>td>div").length;t++)$(document.querySelectorAll("tbody>tr>td>div")[t]).hasClass("layui-form-checked")&&e.push($(document.querySelectorAll("tbody>tr>td>div")[t]).attr("data-id"));return e}function n(){a();var e=Cookie.getCookie("mohu")?"page="+Cookie.getCookie("page")+"&qty="+Cookie.getCookie("qty")+"&sort="+Cookie.getCookie("sort")+"&desc="+Cookie.getCookie("desc")+"&mohu="+Cookie.getCookie("mohu")+"&shopName="+$(".shopName").val()+"&classify="+$("#fenlei").val():"page="+Cookie.getCookie("page")+"&qty="+Cookie.getCookie("qty")+"&sort="+Cookie.getCookie("sort")+"&desc="+Cookie.getCookie("desc")+"&mohu="+Cookie.getCookie("mohu");$.ajax({type:"get",url:"/api/list",data:e,success:function(e){var t;$("#bit").val(Cookie.getCookie("qty")),$("tbody").html(e.data.map(function(e,t){return'<tr data-id="'+e._id+'">\n                    <td>\n                        <div class="layui-unselect layui-form-checkbox " lay-skin="primary" data-id="'+e._id+'">\n                            <i class="layui-icon layui-icon-ok one"></i>\n                        </div>\n                    </td>\n                    <td>'+(t+1)+"</td>\n                    <td>"+e.name+"</td>\n                    <td>"+e.classify+"</td>\n                    <td>"+e.price+"</td>\n                    <td>"+e.sale+"</td>\n                    <td>"+e.inventory+'</td>\n                    <td class="realState">'+e.state+"</td>\n                    <td>"+e.time+'</td>\n                    <td data-id="'+e._id+'">\n                        <button class="layui-btn layui-btn-sm">\n                            <i class="layui-icon compile"></i>\n                        </button>\n                        <button class="layui-btn layui-btn-primary layui-btn-sm ">\n                                <i class="layui-icon cancel"></i>\n                        </button>\n                        <button class="layui-btn layui-btn-sm state" data-id="'+e._id+'">'+("上架"==e.state?"下架":"上架")+"</button>\n                    </td>\n                </tr>"}).join(",")),Cookie.setCookie("allLength",e.allLength),$(".page").html(function(e){for(var t="<p>共"+Cookie.getCookie("allLength")+'条</p>\n                    <button class="layui-btn layui-btn-sm layui-btn-primary pagePrve" style="border-left: 1px solid #ccc;">上一页</button>',o=0;o<e;o++)t+='<button class = "layui-btn layui-btn-sm layui-btn-primary pageNum"> '+(o+1)+"</button>";return t+='<button class="layui-btn layui-btn-sm layui-btn-primary pageNext">下一页</button>'}(Math.ceil(e.allLength/e.qty))),Math.ceil(e.allLength/e.qty)<Cookie.getCookie("page")&&e.allLength/e.qty!=0&&(Cookie.setCookie("page",Math.ceil(e.allLength/e.qty)),Math.ceil(e.allLength/e.qty)<=0&&Cookie.setCookie("page",1),n()),t=Cookie.getCookie("page"),$(".page button").eq(t).removeClass("layui-btn-primary"),$(".toPage input").prop("max",Math.ceil(e.allLength/e.qty)),i()}})}userShow(),Cookie.getCookie("page")||(Cookie.setCookie("page",1),Cookie.setCookie("qty",10),Cookie.setCookie("sort","time"),Cookie.setCookie("desc",1),Cookie.setCookie("mohu","")),a(),$("thead").on("click","img",function(e){e=event||window.event;$(e.target).hasClass("sheng")&&(t(),$(e.target).prop("src","../img/jiantou1.png"),Cookie.setCookie("sort",$(e.target).parent().attr("data-type")),Cookie.setCookie("desc",1),n()),$(e.target).hasClass("jiang")&&(t(),$(e.target).prop("src","../img/jiantou1.png"),Cookie.setCookie("sort",$(e.target).parent().attr("data-type")),Cookie.setCookie("desc","-1"),n())}),function(){for(var e=0;e<$("thead>tr>th").length;e++)$("thead>tr>th").eq(e).attr("data-type")==Cookie.getCookie("sort")&&(1==Cookie.getCookie("desc")?$("thead>tr>th").eq(e).children().eq(0).prop("src","../img/jiantou1.png"):-1==Cookie.getCookie("desc")&&$("thead>tr>th").eq(e).children().eq(1).prop("src","../img/jiantou1.png"))}(),$(".layui-body").on("click",function(e){e=event||window.event;$(e.target).hasClass("one")&&($(e.target).parent().hasClass("layui-form-checked")?$(e.target).parent().removeClass("layui-form-checked"):$(e.target).parent().addClass("layui-form-checked"),!function(){for(var e=[].concat(_toConsumableArray(document.querySelectorAll(".one"))),t=0;t<e.length;t++)if(0==[].concat(_toConsumableArray(e[t].parentElement.classList)).includes("layui-form-checked"))return!1;return!0}()?$(".all").parent().removeClass("layui-form-checked"):$(".all").parent().addClass("layui-form-checked"))}),$(".layui-body").on("click",$(".all"),function(e){e=event||window.event;$(e.target).hasClass("all")&&($(e.target).parent().hasClass("layui-form-checked")?($(e.target).parent().removeClass("layui-form-checked"),o(!1)):($(e.target).parent().addClass("layui-form-checked"),o(!0)))}),$(".top").on("click",function(e){e=event||window.event;if($(e.target).hasClass("addAll")&&(location.href="../html/addgoods.html"),$(e.target).hasClass("deteleAll")){a();var t=i(),o=JSON.stringify(t);0<t.length?confirm("是否删除所选商品信息")&&$.ajax({type:"get",url:"/api/list/cancelMany",data:"_id="+o,success:function(e){1==e.code?(alert("删除成功"),$(".all").parent().removeClass("layui-form-checked"),n()):alert("删除失败")}}):alert("请选择需要删除的数据")}$(e.target).hasClass("search")&&($(".shopName").val().trim()?(Cookie.setCookie("mohu","mohu"),n()):alert("请输入商品名称"))}),$("tbody").on("click",function(e){e=event||window.event;if($(e.target).hasClass("compile")&&(location.href="../html/addgoods.html?_id="+$(e.target).parent().parent().attr("data-id")),$(e.target).hasClass("cancel")){var t=$(e.target).parent().parent().attr("data-id");confirm("是否删除该条商品信息")&&(a(),$.ajax({type:"get",url:"/api/list/cancel",data:"_id="+t,success:function(e){1==e.code?(alert("删除成功"),n()):alert("删除失败")}}))}$(e.target).hasClass("state")&&$.ajax({type:"get",url:"/api/list/update",data:"_id="+$(e.target).attr("data-id")+"&state="+$(e.target).html(),success:function(e){1==e.code?n():alert("修改失败")}})}),n(),$(".page").on("click","button",function(e){$(e.target).hasClass("pageNum")&&(a(),function(){for(var e=1;e<$(".page button").length-1;e++)$(".page button").eq(e).addClass("layui-btn-primary")}(),Cookie.setCookie("page",$(e.target).html()),n()),$(e.target).hasClass("pagePrve")&&(a(),1<Cookie.getCookie("page")&&(Cookie.setCookie("page",Cookie.getCookie("page")-1),n())),$(e.target).hasClass("pageNext")&&(a(),Cookie.getCookie("page")<$(".page").children().length-2&&(Cookie.setCookie("page",1*Cookie.getCookie("page")+1),n()))}),$("#bit").on("input",function(){Cookie.setCookie("qty",$(this).val()),Math.ceil(Cookie.getCookie("allLength")/$(this).val())<Cookie.getCookie("Page")&&Cookie.setCookie("page",Math.ceil(Cookie.getCookie("allLength")/$(this).val())),n()}),$(".toPage input").on("input",function(){1*$(this).val()>1*$(this).prop("max")?$(this).val($(this).prop("max")):$(this).val()<1&&$(this).val(1)}),$(".toPageBtn").on("click",function(){Cookie.setCookie("page",$(".toPage input").val()),n()})});